Resources:
  cdkVpc3BDA7A91:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.1.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
      Tags:
        - Key: Name
          Value: edx-build-aws-vpc
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/Resource
  cdkVpcApplicationPublicSubnet1SubnetABA33F78:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.1.0.0/24
      VpcId:
        Ref: cdkVpc3BDA7A91
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1
        - Key: aws-cdk:subnet-name
          Value: ApplicationPublic
        - Key: aws-cdk:subnet-type
          Value: Public
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/Subnet
  cdkVpcApplicationPublicSubnet1RouteTableDA2B677F:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: cdkVpc3BDA7A91
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/RouteTable
  cdkVpcApplicationPublicSubnet1RouteTableAssociationCB159642:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPublicSubnet1RouteTableDA2B677F
      SubnetId:
        Ref: cdkVpcApplicationPublicSubnet1SubnetABA33F78
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/RouteTableAssociation
  cdkVpcApplicationPublicSubnet1DefaultRoute13BB5655:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPublicSubnet1RouteTableDA2B677F
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: cdkVpcIGW472C7F82
    DependsOn:
      - cdkVpcVPCGW3EC4BD15
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/DefaultRoute
  cdkVpcApplicationPublicSubnet1EIP8A06C0E7:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/EIP
  cdkVpcApplicationPublicSubnet1NATGateway31350BA6:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - cdkVpcApplicationPublicSubnet1EIP8A06C0E7
          - AllocationId
      SubnetId:
        Ref: cdkVpcApplicationPublicSubnet1SubnetABA33F78
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet1/NATGateway
  cdkVpcApplicationPublicSubnet2Subnet9D205005:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.1.1.0/24
      VpcId:
        Ref: cdkVpc3BDA7A91
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2
        - Key: aws-cdk:subnet-name
          Value: ApplicationPublic
        - Key: aws-cdk:subnet-type
          Value: Public
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/Subnet
  cdkVpcApplicationPublicSubnet2RouteTable47875601:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: cdkVpc3BDA7A91
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/RouteTable
  cdkVpcApplicationPublicSubnet2RouteTableAssociation2E7D5707:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPublicSubnet2RouteTable47875601
      SubnetId:
        Ref: cdkVpcApplicationPublicSubnet2Subnet9D205005
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/RouteTableAssociation
  cdkVpcApplicationPublicSubnet2DefaultRoute4F874009:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPublicSubnet2RouteTable47875601
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId:
        Ref: cdkVpcIGW472C7F82
    DependsOn:
      - cdkVpcVPCGW3EC4BD15
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/DefaultRoute
  cdkVpcApplicationPublicSubnet2EIP22A8820F:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/EIP
  cdkVpcApplicationPublicSubnet2NATGateway7AA5D907:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId:
        Fn::GetAtt:
          - cdkVpcApplicationPublicSubnet2EIP22A8820F
          - AllocationId
      SubnetId:
        Ref: cdkVpcApplicationPublicSubnet2Subnet9D205005
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPublicSubnet2/NATGateway
  cdkVpcApplicationPrivateSubnet1Subnet97656790:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.1.2.0/24
      VpcId:
        Ref: cdkVpc3BDA7A91
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1
        - Key: aws-cdk:subnet-name
          Value: ApplicationPrivate
        - Key: aws-cdk:subnet-type
          Value: Private
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1/Subnet
  cdkVpcApplicationPrivateSubnet1RouteTable6EE96623:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: cdkVpc3BDA7A91
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1/RouteTable
  cdkVpcApplicationPrivateSubnet1RouteTableAssociation26656FBF:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPrivateSubnet1RouteTable6EE96623
      SubnetId:
        Ref: cdkVpcApplicationPrivateSubnet1Subnet97656790
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1/RouteTableAssociation
  cdkVpcApplicationPrivateSubnet1DefaultRouteA2D6EEB5:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPrivateSubnet1RouteTable6EE96623
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: cdkVpcApplicationPublicSubnet1NATGateway31350BA6
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet1/DefaultRoute
  cdkVpcApplicationPrivateSubnet2Subnet02CC5070:
    Type: AWS::EC2::Subnet
    Properties:
      CidrBlock: 10.1.3.0/24
      VpcId:
        Ref: cdkVpc3BDA7A91
      AvailabilityZone:
        Fn::Select:
          - 1
          - Fn::GetAZs: ""
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2
        - Key: aws-cdk:subnet-name
          Value: ApplicationPrivate
        - Key: aws-cdk:subnet-type
          Value: Private
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2/Subnet
  cdkVpcApplicationPrivateSubnet2RouteTable2526BD63:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId:
        Ref: cdkVpc3BDA7A91
      Tags:
        - Key: Name
          Value: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2/RouteTable
  cdkVpcApplicationPrivateSubnet2RouteTableAssociationC4B89ABA:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPrivateSubnet2RouteTable2526BD63
      SubnetId:
        Ref: cdkVpcApplicationPrivateSubnet2Subnet02CC5070
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2/RouteTableAssociation
  cdkVpcApplicationPrivateSubnet2DefaultRouteE51F7989:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId:
        Ref: cdkVpcApplicationPrivateSubnet2RouteTable2526BD63
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId:
        Ref: cdkVpcApplicationPublicSubnet2NATGateway7AA5D907
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/ApplicationPrivateSubnet2/DefaultRoute
  cdkVpcIGW472C7F82:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: edx-build-aws-vpc
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/IGW
  cdkVpcVPCGW3EC4BD15:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId:
        Ref: cdkVpc3BDA7A91
      InternetGatewayId:
        Ref: cdkVpcIGW472C7F82
    Metadata:
      aws:cdk:path: CdkWorkshopStack/cdk-Vpc/VPCGW
  edxbuildawss39543392C:
    Type: AWS::S3::Bucket
    Properties:
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-build-aws-s3/Resource
  edxProjectRoleEC195CF4:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: ec2.amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edxProjectRole/Resource
  edxProjectRoleDefaultPolicy472F68EB:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - iam:*
              - rds:*
              - sns:*
              - cloudformation:*
              - rekognition:*
              - ec2:*
              - cognito-idp:*
              - sqs:*
              - xray:*
              - s3:*
              - elasticloadbalancing:*
              - cloud9:*
              - lambda:*
              - tag:GetResources
              - logs:*
              - kms:ListKeyPolicies
              - kms:GenerateRandom
              - kms:ListRetirableGrants
              - kms:GetKeyPolicy
              - kms:ListResourceTags
              - kms:ReEncryptFrom
              - kms:ListGrants
              - kms:GetParametersForImport
              - kms:ListKeys
              - kms:GetKeyRotationStatus
              - kms:ListAliases
              - kms:ReEncryptTo
              - kms:DescribeKey
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
              - s3:DeleteObject*
              - s3:PutObject*
              - s3:Abort*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - edxbuildawss39543392C
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - edxbuildawss39543392C
                        - Arn
                    - /*
        Version: "2012-10-17"
      PolicyName: edxProjectRoleDefaultPolicy472F68EB
      Roles:
        - Ref: edxProjectRoleEC195CF4
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edxProjectRole/DefaultPolicy/Resource
  edxec2sgB3E5891F:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Allow 8080 access to ec2 instances
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          Description: Allow all outbound traffic by default
          IpProtocol: "-1"
      SecurityGroupIngress:
        - CidrIp: 0.0.0.0/0
          Description: Allow inbound 8080 port
          FromPort: 8080
          IpProtocol: tcp
          ToPort: 8080
      VpcId:
        Ref: cdkVpc3BDA7A91
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-ec2-sg/Resource
  edxec2instance1InstanceProfile09E5B6F0:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Roles:
        - Ref: edxProjectRoleEC195CF4
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-ec2-instance1/InstanceProfile
  edxec2instance17A066E81:
    Type: AWS::EC2::Instance
    Properties:
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      IamInstanceProfile:
        Ref: edxec2instance1InstanceProfile09E5B6F0
      ImageId:
        Ref: SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter
      InstanceType: t2.micro
      SecurityGroupIds:
        - Fn::GetAtt:
            - edxec2sgB3E5891F
            - GroupId
      SubnetId:
        Ref: cdkVpcApplicationPrivateSubnet1Subnet97656790
      Tags:
        - Key: Name
          Value: edx-ec2-instance
      UserData:
        Fn::Base64:
          Fn::Join:
            - ""
            - - >-
                #!/bin/bash

                sudo yum install python37 -y

                sudo yum install python-pip -y

                wget https://s3-us-west-2.amazonaws.com/us-west-2-tcdev/courses/AWS-100-ADG/v1.1.0/exercises/ex-rekognition.zip

                unzip ex-rekognition.zip

                cd exercise-rekognition/FlaskApp

                python3 -m venv venv

                source venv/bin/activate

                pip3 install boto3

                pip3 install -r requirements.txt

                pip3 install Pillow

                export PHOTOS_BUCKET=
              - Ref: edxbuildawss39543392C
              - >-
                
                export FLASK_SECRET=kuma

                export AWS_DEFAULT_REGION=us-east-1

                python3 application.py
    DependsOn:
      - edxProjectRoleDefaultPolicy472F68EB
      - edxProjectRoleEC195CF4
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-ec2-instance1/Resource
  edxec2instance2InstanceProfile40196251:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Roles:
        - Ref: edxProjectRoleEC195CF4
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-ec2-instance2/InstanceProfile
  edxec2instance2AFD845AC:
    Type: AWS::EC2::Instance
    Properties:
      AvailabilityZone:
        Fn::Select:
          - 0
          - Fn::GetAZs: ""
      IamInstanceProfile:
        Ref: edxec2instance2InstanceProfile40196251
      ImageId:
        Ref: SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter
      InstanceType: t2.micro
      SecurityGroupIds:
        - Fn::GetAtt:
            - edxec2sgB3E5891F
            - GroupId
      SubnetId:
        Ref: cdkVpcApplicationPrivateSubnet1Subnet97656790
      Tags:
        - Key: Name
          Value: edx-ec2-instance
      UserData:
        Fn::Base64:
          Fn::Join:
            - ""
            - - >-
                #!/bin/bash

                sudo yum install python37 -y

                sudo yum install python-pip -y

                wget https://s3-us-west-2.amazonaws.com/us-west-2-tcdev/courses/AWS-100-ADG/v1.1.0/exercises/ex-rekognition.zip

                unzip ex-rekognition.zip

                cd exercise-rekognition/FlaskApp

                python3 -m venv venv

                source venv/bin/activate

                pip3 install boto3

                pip3 install -r requirements.txt

                pip3 install Pillow

                export PHOTOS_BUCKET=
              - Ref: edxbuildawss39543392C
              - >-
                
                export FLASK_SECRET=kuma

                export AWS_DEFAULT_REGION=us-east-1

                python3 application.py
    DependsOn:
      - edxProjectRoleDefaultPolicy472F68EB
      - edxProjectRoleEC195CF4
    Metadata:
      aws:cdk:path: CdkWorkshopStack/edx-ec2-instance2/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Modules: aws-cdk=1.18.0,@aws-cdk/aws-cloudwatch=1.18.0,@aws-cdk/aws-ec2=1.18.0,@aws-cdk/aws-events=1.18.0,@aws-cdk/aws-iam=1.18.0,@aws-cdk/aws-kms=1.18.0,@aws-cdk/aws-s3=1.18.0,@aws-cdk/aws-ssm=1.18.0,@aws-cdk/core=1.18.0,@aws-cdk/cx-api=1.18.0,@aws-cdk/region-info=1.18.0,jsii-runtime=node.js/v10.16.3
Parameters:
  SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter:
    Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>
    Default: /aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2

